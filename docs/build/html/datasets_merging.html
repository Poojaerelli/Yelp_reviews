

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Performing Contextual analysis: &mdash; Yelp_reviews 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Plotting the output" href="plotting.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Yelp_reviews
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="sentiment_analysis.html">Performing sentiment analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Plotting the output</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Performing Contextual analysis:</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#merging-yelp-business-and-review-datasets">1. merging yelp business and review datasets:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#performing-contextual-analysis-on-merged-data">2. Performing contextual analysis on merged data:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plotting-positive-and-negative-contextual-words-using-wordcloud">3. Plotting positive and negative contextual words using wordcloud:</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Yelp_reviews</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><strong>Performing Contextual analysis:</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/datasets_merging.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="performing-contextual-analysis">
<h1><strong>Performing Contextual analysis:</strong><a class="headerlink" href="#performing-contextual-analysis" title="Permalink to this headline">¶</a></h1>
<p>In this step, contextual analysis is performed on yelp reviews dataset. Actually what is it…?
Performing sentiment analysis will let you know whether a particular text is giving positive or negative review but we don’t know why poeple are giving such reviews and why they are feeling in that way. So, here <strong>contextual analysis</strong> will help you to know the reason behind each review.</p>
<p>Here, contextual analysis is performed on reviews of different restaurant’s in the yelp business dataset. For doing this, restaurants name from the business dataset and their respective review text from the review dataset are required.
This can be done in following steps:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#st1"><span class="std std-ref">merging business and review datasets</span></a></p></li>
<li><p><a class="reference internal" href="#st2"><span class="std std-ref">performing contextual analysis on merged data</span></a></p></li>
<li><p><a class="reference internal" href="#st3"><span class="std std-ref">plotting positive and negative contextual words using wordcloud</span></a></p></li>
</ol>
<div class="section" id="merging-yelp-business-and-review-datasets">
<span id="st1"></span><h2>1. merging yelp business and review datasets:<a class="headerlink" href="#merging-yelp-business-and-review-datasets" title="Permalink to this headline">¶</a></h2>
<p>Merging of both the datasets can be done as follows:</p>
<ul class="simple">
<li><p>Firstly, load the business and review datasets using pandas library.</p></li>
<li><p>Dropping out unwanted columns from the datasets.</p></li>
<li><p>Select the required categories.</p></li>
<li><p>Merge the datasets into a dataframe as chunks. To avoid heavy load on memory, data is merged as chunks of 500000 reviews at a time.</p></li>
<li><p>Finally save the data as a csv file.</p></li>
</ul>
<p>Now, let’s code for this..</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># loading business and review datasets</span>
<span class="n">business_path</span> <span class="o">=</span> <span class="s2">&quot;path for yelp_academic_dataset_business.json file&quot;</span>
<span class="n">review_path</span> <span class="o">=</span> <span class="s2">&quot;path for yelp_academic_dataset_review.json file&quot;</span>
<span class="n">b_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">business_path</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># dropping unwanted columns from business dataset</span>
<span class="n">columns_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">,</span> <span class="s1">&#39;is_open&#39;</span><span class="p">,</span> <span class="s1">&#39;review_count&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;postal_code&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;attributes&#39;</span><span class="p">]</span>
<span class="n">b_data</span> <span class="o">=</span> <span class="n">b_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns_to_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># selecting only restaurants categories. Any of the required categories can be selected</span>
<span class="n">business_data</span> <span class="o">=</span> <span class="n">b_data</span><span class="p">[</span><span class="n">b_data</span><span class="p">[</span><span class="s1">&#39;categories&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Restaurants&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

<span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">500000</span>
<span class="n">r_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">review_path</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">)</span>

<span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r_data</span><span class="p">:</span>
 <span class="n">chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;review_id&#39;</span><span class="p">,</span> <span class="s1">&#39;useful&#39;</span><span class="p">,</span> <span class="s1">&#39;funny&#39;</span><span class="p">,</span> <span class="s1">&#39;cool&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># dropping unwanted columns from reviews dataset</span>
 <span class="n">chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stars&#39;</span><span class="p">:</span> <span class="s1">&#39;review_stars&#39;</span><span class="p">})</span> <span class="c1"># to avoid confusion with stars column in business dataset, stars column in reviews dataset is renamed as review_stars</span>
 <span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">business_data</span><span class="p">,</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;business_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span> <span class="c1"># merging the datasets</span>
 <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">merged_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Completed merging&quot;</span><span class="p">)</span>
<span class="n">final_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">csv_name</span> <span class="o">=</span> <span class="s2">&quot;yelp_reviews_Restaurants_categories.csv&quot;</span>
<span class="n">final_dataset</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># writing the merged data into csv file</span>
</pre></div>
</div>
<p>Cool!.. merging is done. Now, let’s go for the actual task.</p>
</div>
<div class="section" id="performing-contextual-analysis-on-merged-data">
<span id="st2"></span><h2>2. Performing contextual analysis on merged data:<a class="headerlink" href="#performing-contextual-analysis-on-merged-data" title="Permalink to this headline">¶</a></h2>
<p>This process is somewhat similar to sentiment analysis except saving the positive and negative review texts into seperate files. So, let’s dive into coding directly..</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">nltk</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="c1"># data preprocessing</span>
<span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">review_text</span><span class="p">):</span>
 <span class="n">remove_pctn</span> <span class="o">=</span> <span class="p">[</span><span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">review_text</span> <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">]</span>
 <span class="n">remove_pctn</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">remove_pctn</span><span class="p">)</span>
 <span class="n">lwr</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">remove_pctn</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
 <span class="n">final_word</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">lwr</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)]</span>
 <span class="k">return</span> <span class="n">final_word</span>

<span class="c1"># loading the merged dataset</span>
<span class="n">FILE</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;yelp_reviews_Restaurants_categories.csv&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;charmap&#39;</span><span class="p">)</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">FILE</span><span class="p">[:</span><span class="mi">5000</span><span class="p">]</span> <span class="c1"># selecting only 5000 reviews</span>

<span class="n">filtered_data</span> <span class="o">=</span> <span class="n">file</span><span class="p">[(</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;review_stars&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">file</span><span class="p">[</span><span class="s1">&#39;review_stars&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="p">[</span><span class="s1">&#39;review_stars&#39;</span><span class="p">]</span>
<span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">analyzer</span><span class="o">=</span><span class="n">preprocess</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">MLPClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">pos_comments</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">neg_comments</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
 <span class="n">i</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
 <span class="n">name</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
 <span class="n">t</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
 <span class="n">c_t</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="n">t</span><span class="p">])</span>
 <span class="n">predict</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">c_t</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
 <span class="k">if</span> <span class="n">predict</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
     <span class="n">pos_comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
 <span class="k">else</span><span class="p">:</span>
     <span class="n">neg_comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

<span class="c1"># For positive comments</span>
<span class="n">newfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;Pos_context.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;charmap&#39;</span><span class="p">)</span>
<span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;business_name&#39;</span><span class="p">,</span> <span class="s1">&#39;positive_comment&#39;</span><span class="p">]</span>
<span class="n">dictwriter</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">newfile</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
<span class="n">dictwriter</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
<span class="n">b_name</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">p_comment</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">pos_comments</span><span class="p">:</span>
 <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
 <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">b_name</span><span class="p">:</span>
     <span class="n">b_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
 <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_comment</span><span class="p">:</span>
     <span class="n">p_comment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
     <span class="n">token</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
     <span class="n">token</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">token</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">]</span>
     <span class="n">bi_grams</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">bigrams</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
     <span class="k">for</span> <span class="n">gram</span> <span class="ow">in</span> <span class="n">bi_grams</span><span class="p">:</span>
         <span class="n">tags</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">pos_tag</span><span class="p">(</span><span class="n">gram</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
             <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;JJ&#39;</span><span class="p">:</span>
                 <span class="n">dictwriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span><span class="s1">&#39;business_name&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;positive_comment&#39;</span><span class="p">:</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>

<span class="n">newfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># For negative comments</span>
<span class="n">newfile1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;Neg_context.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;charmap&#39;</span><span class="p">)</span>
<span class="n">header1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;business_name&#39;</span><span class="p">,</span> <span class="s1">&#39;negative_comment&#39;</span><span class="p">]</span>
<span class="n">dictwriter1</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">newfile1</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">header1</span><span class="p">)</span>
<span class="n">dictwriter1</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
<span class="n">b_name1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">n_comment</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">neg_comments</span><span class="p">:</span>
 <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
 <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">b_name1</span><span class="p">:</span>
     <span class="n">b_name1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
 <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">n_comment</span><span class="p">:</span>
     <span class="n">n_comment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
     <span class="n">token</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
     <span class="n">token</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">token</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">]</span>
     <span class="n">bi_grams</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">bigrams</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
     <span class="k">for</span> <span class="n">gram</span> <span class="ow">in</span> <span class="n">bi_grams</span><span class="p">:</span>
         <span class="n">tags</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">pos_tag</span><span class="p">(</span><span class="n">gram</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
             <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;JJ&#39;</span><span class="p">:</span>
                 <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;good&#39;</span><span class="p">:</span>
                     <span class="n">dictwriter1</span><span class="o">.</span><span class="n">writerow</span><span class="p">({</span><span class="s1">&#39;business_name&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;negative_comment&#39;</span><span class="p">:</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>

<span class="n">newfile1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>In the above code, after training the model each review text is saved into seperate pos_comments and neg_comments lists. Then each review text from pos_comment list is tokenized and divided into bigrams to extract the adjectives by applying pos-tagging.
Those adjectives are saved into a csv file using dictwriter function. Same thing is done for neg_comments list also. After completing this step, you will be having two csv files for positive and negative comments.</p>
</div>
<div class="section" id="plotting-positive-and-negative-contextual-words-using-wordcloud">
<span id="st3"></span><h2>3. Plotting positive and negative contextual words using wordcloud:<a class="headerlink" href="#plotting-positive-and-negative-contextual-words-using-wordcloud" title="Permalink to this headline">¶</a></h2>
<p>Wordcloud can be used to display the words in a sentence based on it’s frequency. Frequency defines how many times the word is repeated. More the frequency, more the size of the word.</p>
<p>Let’s code for this..</p>
<p><strong>Plotting positive comments:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span><span class="p">,</span> <span class="n">STOPWORDS</span>

<span class="n">file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Pos_context.csv&#39;</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">positive_comment</span><span class="p">)</span>

<span class="n">word</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;Set2&#39;</span><span class="p">,</span>
              <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="n">STOPWORDS</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Positive comments for yelp restaurants&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Executing this code snippet will give you the output as below,</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="images/positive.png"><img alt="images/positive.png" src="images/positive.png" /></a>
</div>
<p><strong>Plotting negative comments:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span><span class="p">,</span> <span class="n">STOPWORDS</span>

<span class="n">file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Neg_context.csv&#39;</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">negative_comment</span><span class="p">)</span>

<span class="n">word</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;Set2&#39;</span><span class="p">,</span>
              <span class="n">collocations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stopwords</span><span class="o">=</span><span class="n">STOPWORDS</span><span class="p">)</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Negative comments for yelp restaurants&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>This will give you the output as below,</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="images/negative.png"><img alt="images/negative.png" src="images/negative.png" /></a>
</div>
<p>It’s done..</p>
<p>Thanks for reading..</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="plotting.html" class="btn btn-neutral float-left" title="Plotting the output" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, pooja.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>